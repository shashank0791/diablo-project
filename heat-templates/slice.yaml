heat_template_version: 2015-04-30
description: CPU intensive resource.

parameters:
  availability_zone:
    type: string
    description: The Availability Zone to launch the instance.
  image_id:
    type: string
    label: Image ID
    description: Image to be used for compute instance
    constraints:
      - custom_constraint: glance.image
  instance_type:
    type: string
    label: Flavor Type
    description: Flavor Type
    constraints:
      - custom_constraint: nova.flavor
  network_id:
    type: string
    label: Network ID/Name
    description: Network to be used for compute instance.
  key:
    type: string
    label: Key name
    description: Name of key-pair to be installed on the compute instance.
resources:
  backend:
    type: backend.yaml
    properties:
      image_id: { get_param: image_id }
      instance_type: { get_param: instance_type }
      network_id: { get_param: network_id }
      availability_zone: { get_param: availability_zone }
      key: { get_param: key }
  api:
    type: api.yaml
    properties:
      image_id: { get_param: image_id }
      instance_type: { get_param: instance_type }
      network_id: { get_param: network_id }
      availability_zone: { get_param: availability_zone }
      key: { get_param: key }
      mysql_server: { get_attr: [backend, ip] }
  frontend:
    type: frontend.yaml
    properties:
      image_id: { get_param: image_id }
      instance_type: { get_param: instance_type }
      network_id: { get_param: network_id }
      availability_zone: { get_param: availability_zone }
      api_server: { get_attr: [api, ip] }
      key: { get_param: key }
